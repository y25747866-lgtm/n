
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the NexoraOS application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to the user's current subscription. (Relationship: User 1:1 Subscription)"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription."
        },
        "planId": {
          "type": "string",
          "description": "Identifier for the subscription plan (e.g., monthly, annual)."
        },
        "startDate": {
          "type": "string",
          "description": "Date when the subscription started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date when the subscription ends.",
          "format": "date-time"
        },
        "creditsRemaining": {
          "type": "number",
          "description": "Number of credits remaining for content generation."
        },
        "coverRegenerationsRemaining": {
          "type": "number",
          "description": "Number of cover regenerations remaining."
        }
      },
      "required": [
        "id",
        "planId",
        "startDate",
        "endDate",
        "creditsRemaining",
        "coverRegenerationsRemaining"
      ]
    },
    "GeneratedProduct": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GeneratedProduct",
      "type": "object",
      "description": "Represents a generated product (ebook, course, etc.).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the generated product."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the user who generated the product. (Relationship: User 1:N GeneratedProduct)"
        },
        "topic": {
          "type": "string",
          "description": "Topic or niche of the generated product."
        },
        "productType": {
          "type": "string",
          "description": "Type of product (Ebook, Course Script, etc.)."
        },
        "tone": {
          "type": "string",
          "description": "Tone of the content (Casual, Professional, Persuasive)."
        },
        "length": {
          "type": "string",
          "description": "Length of the content (Short, Medium, Long)."
        },
        "coverStyle": {
          "type": "string",
          "description": "Style preset for the cover image (Minimal, Photo, etc.)."
        },
        "contentUrl": {
          "type": "string",
          "description": "URL to the generated content (e.g., PDF, DOCX)."
        },
        "coverImageUrl": {
          "type": "string",
          "description": "URL to the generated cover image."
        },
        "generationDate": {
          "type": "string",
          "description": "Date and time when the product was generated.",
          "format": "date-time"
        },
        "downloaded": {
          "type": "boolean",
          "description": "Indicates whether the user has downloaded the generated product."
        }
      },
      "required": [
        "id",
        "userId",
        "topic",
        "productType",
        "generationDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores subscription details for each user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "subscriptionId",
              "description": "The unique identifier for the user's subscription."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/generatedProducts/{generatedProductId}",
        "definition": {
          "entityName": "GeneratedProduct",
          "schema": {
            "$ref": "#/backend/entities/GeneratedProduct"
          },
          "description": "Stores generated products for each user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "generatedProductId",
              "description": "The unique identifier for the generated product."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the NexoraOS application.  It leverages path-based ownership for user-generated content and denormalization to avoid complex security rules with `get()` calls. Authorization Independence is achieved by embedding necessary authorization data (like `userId` on `GeneratedProduct` documents) directly within the documents, removing the need to fetch parent document data for access control. QAPs are addressed through structural segregation; private user data is stored under `/users/{userId}`, enabling simple rules to control access. The structure also supports the application's requirements for managing user subscriptions and generated products, including the need to track download history and enable cover regeneration.\n\n*   `/users/{userId}`: Stores user profiles, ensuring private data is segregated and accessible only to the authenticated user.\n*   `/users/{userId}/subscriptions/{subscriptionId}`: Stores subscription details for each user. This path-based structure ensures that subscriptions are directly linked to the user and accessible only to them.\n*   `/users/{userId}/generatedProducts/{generatedProductId}`: Stores the products generated by users. The `userId` field ensures that each product is tied to the user who created it, simplifying access control. The `downloaded` boolean enables tracking of download history, supporting the requested feature. The `topic`, `productType`, `tone`, `length`, and `coverStyle` fields are also stored here to facilitate potential history and re-generation features.\n\nThis structure supports atomic operations and avoids the need for complex, nested `get()` calls in security rules, thus promoting simpler, more robust, and easily debuggable security rules."
  }
}
